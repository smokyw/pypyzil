# pypyzil

## Обзор

`pypyzil` - это Python-библиотека для парсинга данных с сайта Zillow. Она позволяет извлекать информацию о недвижимости, включая дома, квартиры, арендуемые объекты, продажи и недавно проданные объекты. Библиотека использует веб-скрапинг с поддержкой прокси для обхода ограничений и сбора подробной информации о недвижимости.

## Установка

Для установки библиотеки вам потребуются следующие зависимости:
- `curl_cffi` - для выполнения HTTP-запросов
- `beautifulsoup4` - для парсинга HTML

Установите зависимости с помощью pip:
```bash
pip install curl_cffi beautifulsoup4
```

## Функциональность

### Основные возможности

1. **Получение информации о недвижимости по ID или URL**
   - `get_from_home_id(property_id, proxy_url=None)` - получение информации о доме по ID
   - `get_from_home_url(home_url, proxy_url=None)` - получение информации о доме по URL
   - `get_from_deparment_id(department_id, proxy_url=None)` - получение информации о квартире по ID
   - `get_from_deparment_url(department_url, proxy_url=None)` - получение информации о квартире по URL

2. **Поиск недвижимости**
   - `for_sale(...)` - поиск объектов недвижимости на продажу
   - `for_rent(...)` - поиск объектов недвижимости на аренду
   - `sold(...)` - поиск недавно проданных объектов недвижимости

3. **Вспомогательные функции**
   - `parse_proxy(ip_or_domain, port, username, password)` - генерация URL прокси-сервера

## Подробное описание функций

### Получение информации о конкретных объектах

#### get_from_home_id(property_id, proxy_url=None)
Извлекает информацию о свойстве на основе идентификатора свойства с Zillow.

Аргументы:
- `property_id` (int): ID любого свойства с Zillow
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: распознанная информация о недвижимости

#### get_from_home_url(home_url, proxy_url=None)
Парсит предоставленный URL и извлекает информацию о доме.

Аргументы:
- `home_url` (str): URL недвижимости
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: распознанная информация о недвижимости

#### get_from_deparment_id(department_id, proxy_url=None)
Извлекает информацию о недвижимости на основе идентификатора квартиры с Zillow.

Аргументы:
- `department_id` (str): идентификатор квартиры
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: распознанная информация о недвижимости

#### get_from_deparment_url(department_url, proxy_url=None)
Извлекает информацию о квартире по URL.

Аргументы:
- `department_url` (str): URL квартиры
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: распознанная информация о недвижимости

### Поиск недвижимости

#### for_sale(pagination, search_value, min_beds, max_beds, min_bathrooms, max_bathrooms, min_price, max_price, ne_lat, ne_long, sw_lat, sw_long, zoom_value, proxy_url=None)
Получает результаты поиска объектов недвижимости на продажу. 

Функция возвращает словарь с ключами `mapResults` и `listResults`, где `mapResults` содержит все объявления со всех страниц пагинации. Максимальный размер `mapResults` составляет 500, поэтому если вы получаете результаты размером 500, вам нужно изменить масштаб или координаты, чтобы получить все результаты по конкретному району.

Аргументы:
- `pagination` (int): номер страницы в пагинации
- `search_value` (str): поисковый запрос
- `min_beds` (int): минимальное количество спален
- `max_beds` (int): максимальное количество спален
- `min_bathrooms` (int): минимальное количество ванных комнат
- `max_bathrooms` (int): максимальное количество ванных комнат
- `min_price` (int): минимальная цена
- `max_price` (int): максимальная цена
- `ne_lat` (float): северо-восточная широта
- `ne_long` (float): северо-восточная долгота
- `sw_lat` (float): юго-западная широта
- `sw_long` (float): юго-западная долгота
- `zoom_value` (int): уровень масштабирования карты
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: список недвижимости в формате JSON

#### for_rent(pagination, search_value, is_entire_place, is_room, min_beds, max_beds, min_bathrooms, max_bathrooms, min_price, max_price, ne_lat, ne_long, sw_lat, sw_long, zoom_value, proxy_url=None)
Получает результаты поиска аренды недвижимости.

Аргументы:
- `pagination` (int): номер страницы в пагинации
- `search_value` (str): поисковый запрос
- `is_entire_place` (bool): флаг для поиска целого жилья
- `is_room` (bool): флаг для поиска комнаты
- `min_beds` (int): минимальное количество спален
- `max_beds` (int): максимальное количество спален
- `min_bathrooms` (int): минимальное количество ванных комнат
- `max_bathrooms` (int): максимальное количество ванных комнат
- `min_price` (int): минимальная цена
- `max_price` (int): максимальная цена
- `ne_lat` (float): северо-восточная широта
- `ne_long` (float): северо-восточная долгота
- `sw_lat` (float): юго-западная широта
- `sw_long` (float): юго-западная долгота
- `zoom_value` (int): уровень масштабирования карты
- `proxy_url` (str | None): URL прокси для маскировки запроса (по умолчанию None)

Возвращает:
- `dict[str, Any]`: список недвижимости в формате JSON

#### sold(pagination, search_value, min_beds, max_beds, min_bathrooms, max_bathrooms, min_price, max_price, ne_lat, ne_long, sw_lat, sw_long, zoom_value, proxy_url=None)
Получает результаты поиска недавно проданных объектов недвижимости.

Аргументы те же, что и для `for_sale`, за исключением:
- `search_value` (str): поисковый запрос

Возвращает:
- `dict[str, Any]`: список недвижимости в формате JSON

### Вспомогательные функции

#### parse_proxy(ip_or_domain, port, username, password)
Генерирует URL для прокси-сервера с аутентификацией.

Аргументы:
- `ip_or_domain` (str): IP-адрес или домен прокси-сервера
- `port` (str): порт прокси-сервера
- `username` (str): имя пользователя для аутентификации
- `password` (str): пароль для аутентификации

Возвращает:
- `str`: URL прокси-сервера в формате http://username:password@ip:port

## Особенности и ограничения

1. **Ограничение на количество результатов**: Максимальный размер `mapResults` составляет 500. Даже если вы попытаетесь пройти через все страницы пагинации, результаты не будут больше 500. Рекомендуется не использовать пагинацию, потому что все результаты (максимум 500) уже находятся в `mapResults`.

2. **Использование координат**: Для получения более широкого диапазона результатов можно использовать географические координаты (северо-восточные и юго-западные широта и долгота).

3. **Поддержка прокси**: Все функции поддерживают использование прокси для обхода ограничений и предотвращения блокировки IP-адреса.

4. **Имитация браузера**: Библиотека использует параметр `impersonate="chrome124"` для имитации запроса из браузера Chrome.

## Примеры использования

```python
import pyzill
import json

# Генерация URL прокси
proxy_url = pyzill.parse_proxy("premium.residential.proxyrack.net", "9000", "masamasa-country-US", "G7NR8PY-6UUOGDK-B3KHXDU-JLMUNR7-IXHHRVL-0N0MR6S-AX0ESBN")

# Определение географических границ
ne_lat = 38.602951833355434
ne_long = -87.22283859375
sw_lat = 23.42674607019482
sw_long = -112.93084640625

# Поиск аренды
results_rent = pyzill.for_rent(pagination=1, 
              search_value="", 
              is_entire_place=False, 
              is_room=True,
              min_beds=1, 
              max_beds=None,
              min_bathrooms=None, 
              max_bathrooms=None,
              min_price=10000, 
              max_price=None,
              ne_lat=ne_lat, 
              ne_long=ne_long, 
              sw_lat=sw_lat, 
              sw_long=sw_long,
              zoom_value=15,
              proxy_url=proxy_url)

# Сохранение результатов в JSON-файл
with open("./jsondata_rent2.json", "w") as f:
    json.dump(results_rent, f)
```

## Архитектура

Проект состоит из следующих модулей:

1. **details.py**: Содержит функции для получения информации о конкретных объектах недвижимости по ID или URL.
2. **search.py**: Содержит функции для поиска недвижимости по различным критериям.
3. **parse.py**: Содержит логику для парсинга HTML-контента и извлечения JSON-данных.
4. **utils.py**: Содержит вспомогательные функции для обработки данных и управления прокси.
5. **__init__.py**: Импортирует основные функции для доступа из внешнего кода.

## Зависимости

- `curl_cffi`: используется для выполнения HTTP-запросов с поддержкой имитации браузера
- `beautifulsoup4`: используется для парсинга HTML-документов
- `typing`: используется для аннотаций типов

## Расширенные возможности

Библиотека поддерживает гибкие параметры поиска, включая:
- Фильтрацию по количеству спален и ванных комнат
- Фильтрацию по цене
- Географические фильтры с использованием координат
- Поддержку различных типов недвижимости (дома, квартиры, комнаты)
- Историю продаж

## Заключение

`pypyzil` предоставляет мощный инструмент для получения данных о недвижимости с Zillow с поддержкой фильтрации и прокси-серверов. Библиотека может быть полезна для анализа рынка недвижимости, исследований и других целей, требующих автоматического сбора информации о недвижимости.

Для успешного использования библиотеки рекомендуется использовать прокси-серверы, чтобы избежать блокировки IP-адреса со стороны Zillow, и учитывать ограничения на максимальное количество результатов в 500 записей на запрос.
 
